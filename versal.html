<!DOCTYPE html>
<html>
<head>
<title>Priority Matrix</title>
<script src="bower_components/versal-component-runtime/dist/runtime.min.js"></script>
<link rel="import" href="bower_components/versal-gadget-api/versal-gadget-api.html">
</head>

<body>
<fieldset>
    <div class="feature1">
        <legend>Feature 1</legend>
        <textarea id="story1" name="story1" placeholder="Describe your feature or user story."></textarea>
        <br />
        <!--
            // NOTE:
            // Option values will be multiplied and added together to create an x or y coordinate.
            // More thought needs to go into the option values.
        -->
        <label for="importance">Importance to the User</label>
        <select name="importance" id="importance" size="1">
            <option value="-1">1</option>
            <option value="0">2</option>
            <option value="1">3</option>
            <option value="2">4</option>
            <option value="3">5</option>
        </select>
        <br />
        <label for="revenue" size="1">Revenue Upside</label>
        <select name="revenue"  id="revenue" size="1">
            <option value="0">1</option>
            <option value="1">2</option>
            <option value="1.5">3</option>
            <option value="2">4</option>
            <option value="2.5">5</option>
        </select>
        <br />
        <label for="advantage" size="1">Competitive Advantage</label>
        <select name="advantage" id="advantage" size="1">
            <option value="-2">1</option>
            <option value="-1">2</option>
            <option value="0">3</option>
            <option value="1">4</option>
            <option value="2">5</option>
        </select>
        <br />
        <label for="effort" size="1">Effort to Implementation</label>
        <select name="effort" id="effort" size="1" placeholder="1-5">
            <option value="2">1</option>
            <option value="1">2</option>
            <option value="0">3</option>
            <option value="-1">4</option>
            <option value="-2">5</option>
        </select>
        <br />
        <label for="ease" size="1">Ease of Use</label>
        <select name="ease" id="ease" size="1" placeholder="1-5">
            <option value="0">1</option>
            <option value="1">2</option>
            <option value="1.5">3</option>
            <option value="2">4</option>
            <option value="2.5">5</option>
        </select>
        <br />
        <label for="scalability" size="1">Scalability</label>
        <select name="scalability" id="scalability" size="1" placeholder="1-5">
            <option value="-1">1</option>
            <option value="0">2</option>
            <option value="1">3</option>
            <option value="2">4</option>
            <option value="3">5</option>
        </select>
    </div>
</fieldset>

<!--
    // NOTE:
    // In an ideal world, authors could add multiple metrics and stories.
    // id strings could be trimmed and incremented
    <button id="addMetric">Add Metric</button>
-->
<button id="addStory">Add Story</button>
<button id="generateMatrix">Generate Matrix</button>
<div id="backgroundGrid">
    <svg height="400" viewBox="0 0 400 400" width="400">
        <defs>
            <pattern id="grid20" width="20" height="20" patternUnits="userSpaceOnUse">
                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="gray" stroke-width="1"></path>
            </pattern>
        </defs>
        <rect fill="white" height="800" width="800" y="0"></rect>
        <rect fill="url(#grid20)" height="800" width="800" y="0"></rect>
        <g transform="translate(0,0) scale(1, 1)">
            <line class="l1 s-black " stroke="black" x1="-200" x2="800" y1="200" y2="200"></line>
            <line class="l1 s-black " stroke="black" x1="200" x2="200" y1="-200" y2="800"></line>
        </g>
        <g transform="translate(200, 200) scale(1,-1)">
            <text class="t36 t-mid bold f-black" x="48" y="50">+ +</text>
            <text class="t36 t-mid bold f-black" x="-69" y="50">- +</text>
            <text class="t36 t-mid bold f-black" x="48" y="-50">+ -</text>
            <text class="t36 t-mid bold f-black" x="-69" y="-50">- -</text>
        </g>
    </svg>
</div>
<div id="priorityMatrix">
</div>
<script type="text/javascript">
    var player = new VersalPlayerAPI();

    player.on('editableChanged', function(editableObj){
       if(editableObj.editable) {
       document.body.appendChild(document.createTextNode('author '));
     } else {
       document.body.appendChild(document.createTextNode('learner '));
     }
    });

    // send this command to receive initial events
    player.startListening();

    // continuously watch for changes in height
    player.watchBodyHeight();

    // save a textarea
    var textarea = document.querySelector('textarea');
    textarea.addEventListener('blur', function(){
        player.setAttributes({
          textareaValue: textarea.value
        });
    });

    // change textarea when attributes change
    player.on('attributesChanged', function(attrs){
        if(attrs && attrs.textareaValue) {
            textarea.value = attrs.textareaValue;
        }
    });

    var editable = false;
    player.on('editableChanged', function(editableObj){
       editable = editableObj.editable;
    });

    // set an event listener
    // document.querySelector('img').addEventListener('click', function(){
    //    if (editable) {
    //      player.requestAsset({type: 'image'});
    //    }
    // });

    // persist image to server
    player.on('assetSelected', function(assetData){
     var imageUrl = player.assetUrl(assetData.asset.representations[0].id);
     player.setAttributes({imageUrl: imageUrl});
    });

    player.on('attributesChanged', function(attrs){
        //restore image src
        if(attrs && attrs.imageUrl) {
           document.querySelector('img').setAttribute('src', attrs.imageUrl);
        }
    });

    var button1 = document.querySelector('#addStory');
    button1.addEventListener('click', function() {
       var createStory = document.querySelector('fieldset');
       document.body.appendChild(document.createTextNode(createStory));
    });

   var button2 = document.querySelector('#generateMatrix');
    button2.addEventListener('click', function() {
       var imp = document.querySelector('#importance').value;
       var rev = document.querySelector('#revenue').value;
       var adv = document.querySelector('#advantage').value;
       var eff = document.querySelector('#effort').value;
       var eas = document.querySelector('#ease').value;
       var scal = document.querySelector('#scalability').value;
       var calculatePoint = function() {
            // change multiplier to refine results
            var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width','400');
            svg.setAttribute('viewBox', '0 0 400 400')
            svg.setAttribute('height','400');

            var bgRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            bgRect.setAttribute('width','400');
            bgRect.setAttribute('height','400');
            bgRect.setAttribute('fill','#fff');
            bgRect.setAttribute('y','0');

            var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('width','400');
            rect.setAttribute('height','400');
            rect.setAttribute('fill','#999');
            rect.setAttribute('y','0');

            var grid = document.createElementNS('http://www.w3.org/2000/svg', 'grid');
            grid.setAttribute('line', "class='l1 s-black' x1='-100' x2=400' y1='100' y2='100'");

            var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', (200 + (imp*50 + rev*50 + adv*50)));
            text.setAttribute('y', (200 + (eff*50 + eas*25 + scal*25)));
            // NOTE:  CENTER POINT
            // text.setAttribute('x', '200');
            // text.setAttribute('y', '200');
            text.textContent = '*';

            console.log(text);

            svg.appendChild(bgRect);
            svg.appendChild(rect);
            svg.appendChild(grid);
            svg.appendChild(text); 

            var wp = document.getElementById('priorityMatrix');
            wp.innerHTML='';
            wp.appendChild(svg);

            // document.querySelector("#prioritymatrix").appendChild(text);
            // console.log((imp*50 + rev*50 + adv*50), (eff*50 + eas*25 + scal*25));
       };
       calculatePoint();
    });


</script>
</body>

</html>
